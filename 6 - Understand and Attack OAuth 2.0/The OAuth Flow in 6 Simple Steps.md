
# OAuth 2.0 Authorization Code Flow (Simplified Walkthrough)

## Overview

This note explains the OAuth 2.0 **Authorization Code Flow** in a simplified and digestible way. It outlines each step, explains key terms like `authorization code` and `state`, and includes a high-level visual reference.

> [!info]
> OAuth lets a user log in to one app (the Client) by authenticating through another trusted app (the Provider), like Google.

---

## 1. User Clicks “Login with OAuth”

The **client app** (e.g., `localhost:3001`) redirects the user’s browser to the **OAuth provider** (e.g., `localhost:3000`) using a URL like:

```

/authorize?client_id=...&redirect_uri=...&state=abc123&scope=profile

```

This starts the login flow. The user is sent to the provider’s authorization endpoint.

> [!note]
> The `state` value is a random string generated by the client app to protect against CSRF attacks. It must be saved by the client and validated later.

---

## 2. User Grants Consent

The **OAuth provider** authenticates the user (if not already logged in) and then shows a **consent screen** asking the user to approve access to their information (e.g., profile and email).

If the user approves, the provider prepares to redirect back to the client.

---

## 3. Provider Redirects Back with Authorization Code

After the user consents, the provider redirects the browser to the `redirect_uri` with:

```

/callback?code=xyz123&state=abc123

```

> [!tip]
> `code` is the short-lived authorization code.  
> `state` must match the original value sent by the client to confirm the request is valid.

---

## 4. Token Exchange (Backend)

The **client’s backend server** (not the browser) takes the authorization code and sends a request to the provider to exchange it for tokens:

```

POST /oauth/token  
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code  
client_id=...  
client_secret=...  
code=xyz123  
redirect_uri=...

````

---

## 5. Provider Responds with Tokens

If the request is valid, the provider sends back a response like:

```json
{
  "access_token": "abc123",
  "id_token": "jwt...",
  "token_type": "Bearer",
  "expires_in": 3600
}
````

> [!note]  
> `access_token` allows the client app to access protected APIs.  
> `id_token` contains information about the user (used in OpenID Connect).  
> These tokens are never exposed in the browser.

---

## 6. Client Logs User In

The client app uses the `access_token` to fetch user info and starts a session. The user is now logged in.

---

## Flow Recap

```
[User] ➝ Clicks Login
  ↓
[Client App] ➝ Redirects to ➝ [OAuth Provider]
                           ↳ Consent Screen
                           ↳ Redirect back with ?code + ?state
[Client Backend] ➝ Sends code ➝ [OAuth Provider]
                                 ↳ Returns tokens
[Client App] ➝ Logs in user
```

---

## Key Concepts

|Term|Meaning|
|---|---|
|`client_id`|Identifies the app requesting access|
|`redirect_uri`|Where to send the user after consent|
|`authorization code`|Temporary code used to securely get tokens|
|`access_token`|Token for API access|
|`state`|CSRF protection value to validate the flow|
|`scope`|What permissions the app is requesting|

---

## Summary

> [!summary]  
> OAuth 2.0 Authorization Code Flow allows a user to log in via a trusted provider.  
> The flow is secure because the access tokens are never exposed in the browser, and CSRF protection is enforced using the `state` parameter.
